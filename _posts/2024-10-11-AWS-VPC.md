---
layout: post
title: AWS VPC(Virtual Private Cloud)의 개념 
categories: [AWS, VPC, Network]
description: AWS의 네트워크에 대해서 설명합니다.
keywords: AWS, VPC, Network, 네트워크, AZ
toc: true
toc_sticky: true
---

<br>

### AWS VPC: 네트워크 구성 및 리소스 연결

**Amazon VPC (Virtual Private Cloud)**는 AWS 클라우드 내에서 격리된 가상 네트워크를 생성하는 서비스로, 사용자가 네트워크 설정을 제어하여 리소스와 인터넷 간의 연결을 관리할 수 있습니다.
아래 그림을 통해 VPC 내에서 리소스가 어떻게 배치되고 연결되는지 설명할 수 있습니다.

<br>

```groovy
+--------------------------------------------------+
| Region                                           |
| +------+  start  +--------------------------+    |
| | VPC  |  --->   | Resource(EC2,  RDS, ELB) |    |
| +------+         +--------------------------+    |
| | VPC  |                                         |
| +------+             +------+                    |
| | VPC  |   subnet -> |  AZ  |                    |
| +------+      ^      +------+                    |
|    :  |       |                                  |
|       +-----> Private IP ( x.x.x.x ~ x.x.x.x )   |
|       +-----> ENI (Elastic Network Interface)    |
|                                                  |
+--------------------------------------------------+

권장 Private IP 대역
* 사설 네트워크(feat. Bogon IP) : 
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
```

<br>

##### 1. Region과 VPC

- `Region`:

AWS 인프라스트럭처는 전 세계에 분포된 여러 **리전(Region)**으로 구성됩니다. 각 리전은 물리적으로 분리된 데이터 센터들을 포함하고 있으며, 사용자는 리전을 선택해 리소스를 배포할 수 있습니다.

- `VPC (Virtual Private Cloud)`:

VPC는 리전 내에서 사용자가 정의한 네트워크 공간을 의미합니다. 사용자는 하나의 리전 내에서 여러 VPC를 생성할 수 있으며, 각 VPC는 독립적인 네트워크로서 구성됩니다. VPC는 EC2, RDS, ELB와 같은 AWS 리소스들을 배치하는 논리적 네트워크입니다.

<br>

##### 2. 리소스 및 서브넷

- `리소스 (EC2, RDS, ELB)`:

VPC 안에는 EC2 인스턴스, RDS 데이터베이스, **ELB(Elastic Load Balancer)**와 같은 AWS 리소스들이 배치됩니다. 이러한 리소스들은 VPC 내부에서 지정된 IP 주소와 서브넷을 사용하여 네트워크 상에서 동작합니다.

- `서브넷(Subnet)`:

**서브넷(Subnet)**은 VPC 내에서 IP 주소 대역을 나눠주는 하위 네트워크입니다. 각 서브넷은 특정 가용 영역(AZ, Availability Zone)에 속하며, 하나의 VPC에 여러 서브넷을 만들 수 있습니다. 서브넷은 퍼블릭 서브넷과 프라이빗 서브넷으로 나눌 수 있습니다. 퍼블릭 서브넷은 인터넷과 연결될 수 있고, 프라이빗 서브넷은 외부와 직접적으로 연결되지 않은 보안 네트워크입니다.

<br>

```groovy
+---------------------------------------------------------------+
| Subnet                                                        |
| +---------------+ -> Local (VPC)                              |
| | Routing Table | <- Gateway(External), VPC Endpoint, Peering |
| +---------------+                                             |
| | Network ACL   |                                             |
| +---------------+                                             |
| | Resource      | + Public IP                                 |
| +---------------+                                             |
+---------------------------------------------------------------+

※ Reserved subnet
- 172.16.1.0 : Network ID
- 172.16.1.1 : VPC Router 
- 172.16.1.2 : DNS IP
- 172.16.1.3 : reserved
- 172.16.1.255 : network boardcast 
```

<br>

##### 3. 가용 영역(AZ)

- `AZ (Availability Zone)`:

가용 영역은 리전 내에서 물리적으로 분리된 데이터 센터입니다. VPC 내의 서브넷은 특정 AZ에 배치되어 있으며, 리소스는 이 AZ 내에서 운영됩니다. 이로 인해 가용성과 내구성이 증가하며, 리소스 간의 지연을 줄일 수 있습니다.

<br>

#### 4. 네트워크 구성 요소

- `Private IP`:

VPC 내에서 리소스는 Private IP 주소를 할당받습니다. 이 Private IP는 공용 인터넷과 연결되지 않는 사설 네트워크에서 사용되며, 특정 IP 대역 안에서 리소스 간 통신을 할 수 있습니다.

- `ENI (Elastic Network Interface)`:

ENI는 EC2 인스턴스와 같은 리소스에 연결된 네트워크 인터페이스로, IP 주소, 보안 그룹, 트래픽 필터링 규칙 등을 포함합니다. 하나의 EC2 인스턴스에 여러 ENI를 연결할 수 있으며, 이를 통해 다중 네트워크 인터페이스를 지원할 수 있습니다.

<br>


### VPC 설정 예제

다음은 **AWS VPC(Virtual Private Cloud)**를 설정하는 기본적인 예제입니다. 이 예제에서는 VPC를 생성하고, 서브넷, 인터넷 게이트웨이(Internet Gateway), **라우팅 테이블(Route Table)**을 설정하여 퍼블릭 및 프라이빗 서브넷을 구성합니다.

<br>

##### 1. VPC 생성

<br>

```bash
aws ec2 create-vpc --cidr-block 10.0.0.0/16 --region us-east-1
```

<br>

- `--cidr-block 10.0.0.0/16` : VPC의 IP 주소 범위를 지정합니다. 이 예에서는 10.0.0.0/16 대역을 사용하여 최대 65,536개의 IP 주소를 사용할 수 있습니다.
- `--region us-east-1`: 리전을 지정합니다.

<br>

##### 2. 서브넷 생성

VPC에 두 개의 서브넷을 생성합니다. 하나는 퍼블릭 서브넷, 다른 하나는 프라이빗 서브넷입니다.

<br>

```bash
# 퍼블릭 서브넷 생성
aws ec2 create-subnet --vpc-id <VPC-ID> --cidr-block 10.0.1.0/24 --availability-zone us-east-1a

# 프라이빗 서브넷 생성
aws ec2 create-subnet --vpc-id <VPC-ID> --cidr-block 10.0.2.0/24 --availability-zone us-east-1a
```

- 퍼블릭 서브넷: 10.0.1.0/24 범위.
- 프라이빗 서브넷: 10.0.2.0/24 범위.

<br>


##### 3. 인터넷 게이트웨이(Internet Gateway) 생성 및 연결

퍼블릭 서브넷이 인터넷과 통신할 수 있도록 **인터넷 게이트웨이(IGW)**를 생성하고 VPC에 연결합니다.

<br>

```bash 
# 인터넷 게이트웨이 생성
aws ec2 create-internet-gateway

# VPC에 인터넷 게이트웨이 연결
aws ec2 attach-internet-gateway --vpc-id <VPC-ID> --internet-gateway-id <IGW-ID>
```

<br>

##### 4. 라우팅 테이블(Route Table) 생성 및 설정

퍼블릭 서브넷이 인터넷과 연결될 수 있도록 라우팅 테이블을 생성하고, 인터넷 트래픽을 IGW로 라우팅합니다.

<br>

```bash
# 라우팅 테이블 생성
aws ec2 create-route-table --vpc-id <VPC-ID>

# 인터넷으로 가는 경로 추가
aws ec2 create-route --route-table-id <Route-Table-ID> --destination-cidr-block 0.0.0.0/0 --gateway-id <IGW-ID>
```

<br>

##### 5. 퍼블릭 서브넷에 라우팅 테이블 연결

퍼블릭 서브넷에 생성한 라우팅 테이블을 연결하여 인터넷과 연결합니다.

```bash
# 퍼블릭 서브넷에 라우팅 테이블 연결
aws ec2 associate-route-table --subnet-id <Subnet-ID> --route-table-id <Route-Table-ID>
```